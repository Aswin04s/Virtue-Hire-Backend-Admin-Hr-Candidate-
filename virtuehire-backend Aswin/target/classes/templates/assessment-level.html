<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Level Assessment</title>
    <style>
        body { 
            font-family: Arial; 
            background-color: #f4f7f8; 
            display:flex; 
            justify-content:center; 
            align-items:center; 
            min-height:100vh; 
            margin:0; 
        }
        .assessment-container { 
            background-color:#fff; 
            padding:40px 50px; 
            border-radius:12px; 
            box-shadow:0 6px 18px rgba(0,0,0,0.1); 
            width:600px; 
        }
        h2 { 
            color:#333; 
            margin-bottom:20px; 
            text-align:center; 
        }
        .question { 
            margin-bottom:20px; 
        }
        .question p { 
            font-weight:bold; 
            margin-bottom:5px; 
        }
        .option-btn { 
            display:flex; 
            justify-content: space-between; 
            align-items:center;
            width:100%; 
            margin:5px 0; 
            padding:10px; 
            border-radius:6px; 
            border:1px solid #ccc; 
            cursor:pointer; 
            background-color:#f0f0f0; 
            text-align:left;
            font-size:15px;
            position: relative;
        }
        /* Icons for correct/wrong */
        .option-btn.correct::after {
            content: "✔"; 
            color: #4CAF50; 
            font-weight: bold; 
            margin-left: 10px;
        }
        .option-btn.incorrect::after {
            content: "✖"; 
            color: #f44336; 
            font-weight: bold; 
            margin-left: 10px;
        }
        button.submit-btn { 
            background-color:#2196F3; 
            color:white; 
            padding:10px 20px; 
            border:none; 
            border-radius:6px; 
            font-weight:bold; 
            cursor:pointer; 
            display:block; 
            margin:20px auto 0 auto; 
        }
        button.submit-btn:hover { 
            background-color:#1976D2; 
        }
        .feedback { 
            font-weight:bold; 
            margin-top:5px; 
        }
        .correct { 
            color: #4CAF50; 
        }
        .incorrect { 
            color: #f44336; 
        }
    </style>
</head>
<body>
<div class="assessment-container">
    <h2>Level <span th:text="${level}"></span> Assessment</h2>

    <form th:action="@{/assessment/submit/{level}(level=${level})}" method="post">
        <p>Total Questions: <span th:text="${#lists.size(questions)}"></span></p>

        <div th:each="q : ${questions}" class="question">
            <p th:text="${q.text}" th:data-id="${q.id}">Question text</p>

            <div th:each="opt : ${q.options}" class="option">
                <button type="button" class="option-btn" th:text="${opt}" 
                        th:data-correct="${opt == q.correctAnswer}" 
                        onclick="selectOption(this)"></button>
            </div>

            <input type="hidden" th:name="'q' + ${q.id}" value="" />
            <div class="feedback"></div>
        </div>

        <button type="submit" class="submit-btn">Submit Answers</button>
    </form>
</div>

<script>
function selectOption(button) {
    const questionDiv = button.closest('.question');
    const feedbackDiv = questionDiv.querySelector('.feedback');
    const hiddenInput = questionDiv.querySelector('input[type="hidden"]');

    // Prevent changing answer after first click
    if(hiddenInput.value) return;

    const correctBtn = Array.from(questionDiv.querySelectorAll('.option-btn'))
                            .find(b => b.dataset.correct === "true");

    // Mark selected answer
    if(button.dataset.correct === "true"){
        button.classList.add('correct');
        feedbackDiv.innerText = 'Your answer is correct';
        feedbackDiv.className = 'feedback correct';
    } else {
        button.classList.add('incorrect');
        feedbackDiv.innerText = 'Your answer is incorrect. Correct answer is shown.';
        feedbackDiv.className = 'feedback incorrect';
        // Show tick on the correct answer
        correctBtn.classList.add('correct');
    }

    // Store selected answer in hidden input
    hiddenInput.value = button.innerText;
}
</script>
</body>
</html>
